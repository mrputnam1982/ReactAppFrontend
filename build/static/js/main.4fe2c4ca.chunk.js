(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{275:function(e,t,n){},344:function(e,t,n){},367:function(e,t,n){},394:function(e,t,n){},563:function(e,t){},565:function(e,t){},581:function(e,t,n){},583:function(e,t){},609:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),o=n(38),r=n.n(o),i=(n(367),n(10)),c=(n(97),n(12)),l=n.n(c),u=n(26),d=n(621),m=n(25),h=n.n(m),p=n(43),j=Object(p.b)(),b=n(91),g=new d.a,f=new d.a,O={setName:function(e){g.next(e),localStorage.setItem("name",e)},currentName:g.asObservable(),get currentNameValue(){var e=localStorage.getItem("name");return e||g.value},setRole:function(e){f.next(e),localStorage.setItem("role",JSON.stringify(e))},currentRole:f.asObservable(),get currentRoleValue(){var e=localStorage.getItem("role");return e?JSON.parse(e):f.value}};var v=new d.a,x={setImage:function(e){v.next(e),localStorage.setItem("dataUrl",JSON.stringify(e))},currentImage:v.asObservable(),get currentImageValue(){var e=localStorage.getItem("dataUrl");return e?JSON.parse(e):v.value}};var y=new d.a(JSON.parse(localStorage.getItem("currentUser"))),C={login:function(e,t){return k.apply(this,arguments)},logout:I,getUsernameFromJWT:function(){var e=JSON.parse(localStorage.getItem("currentUser")).token;return S(e).sub},verifyLogin:function(){return w.apply(this,arguments)},loggedIn:!!localStorage.getItem("currentUser"),currentUser:y.asObservable(),get currentUserValue(){return y.value}},S=function(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(t){return null}};function w(){return(w=Object(u.a)(l.a.mark((function e(){var t,n,a,s,o,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new b.a,n=JSON.parse(localStorage.getItem("currentUser")),a=null,console.log("verifyLogin",n),!n){e.next=15;break}if(s=S(n.token),console.log("Decoded JWT",s),!(1e3*s.exp<Date.now())){e.next=15;break}return localStorage.removeItem("currentUser"),o=s.sub,r=t.get("refresh_token").key,i={username:o,cookieValue:r},console.log("JWT expired, create new JWT using refresh token",i),e.next=15,h.a.post("/auth/refresh_token/update",i,{headers:{"Content-Type":"application/json"}}).then((function(e){return localStorage.setItem("currentUser",JSON.stringify(e.data)),y.next(JSON.parse(localStorage.getItem("currentUser"))),console.log("jwt refreshed",e.data),e})).catch((function(e){I()}));case 15:return a="DONE",e.abrupt("return",a);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=Object(u.a)(l.a.mark((function e(t,n){var a,s,o,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new b.a,s="",o="",r="",i="",e.next=7,h.a.put("/auth/login",{username:t,password:n}).then((function(e){console.log(e.data),localStorage.setItem("currentUser",JSON.stringify(e.data)),o=e.data.username,r=e.data.roles,i=e.data.avatar,C.loggedIn=!0,y.next(JSON.parse(localStorage.getItem("currentUser"))),console.log("loggedIn",C.loggedIn)})).catch((function(e){console.log(e),C.loggedIn=!1}));case 7:if(!0!==C.loggedIn){e.next=10;break}return e.next=10,h.a.post("/auth/refresh_token/generate",t,{headers:{"Content-Type":"text/plain"}}).then((function(e){console.log(e.data),s=e.data}));case 10:return s&&(console.log("SetCookie refresh_token",s),a.set(s.name,{key:s.value},{path:"/",maxAge:s.maxAge,secure:s.secure}),console.log(a.getAll())),console.log("AuthenticationService Login",i),e.abrupt("return",{name:o,roles:r,image:i});case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){var e=new b.a;localStorage.removeItem("currentUser"),e.remove("refresh_token",{path:"/"}),C.loggedIn=!1,O.setName(""),O.setRole(""),x.setImage(""),y.next(null),localStorage.removeItem("role"),localStorage.removeItem("name"),localStorage.removeItem("dataUrl"),j.push("/")}var P=n(13),V=n(14),D=n(17),N=n(16),L=n(15),U=n(11),E=n(624),T=n(351),A=n(627),R=n(619),F=n(620),W=n(346),J=n(622),z=n(31),M=n(625),B=n(18),H=n(626),G=n(623),_=n(618),Y=n(348),K=n(59),q=n(68),Z=n(2),Q=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).resetUser=function(){a.setState({email:"",password:""})},a.userChange=function(e){a.setState(Object(B.a)({},e.target.name,e.target.value))},a.onKeyDown=function(e){"Enter"===e.key&&a.handleSubmit()},a.state={email:"",password:"",show:!1,loginFail:!1},a.handleSubmit=a.handleSubmit.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"handleSubmit",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"",e.next=3,C.login(this.state.email,this.state.password);case 3:n=e.sent,console.log("Loginform",C.loggedIn),console.log(n),C.loggedIn?(O.setName(n.name),O.setRole(n.roles[0]),n.image&&x.setImage(n.image.strBase64File),this.setState({loginFail:!1}),j.push("/posts")):this.setState({password:"",loginFail:!0});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.email,n=e.password;return Object(Z.jsx)("div",{children:Object(Z.jsx)(H.a,{className:"border border-dark bg-dark text-white",children:Object(Z.jsxs)(G.a,{onReset:this.resetUser,id:"userFormId",children:[Object(Z.jsx)(H.a.Header,{}),Object(Z.jsxs)(H.a.Body,{children:[Object(Z.jsxs)(G.a.Group,{as:W.a,controlId:"formGridemail",children:[Object(Z.jsx)(G.a.Label,{children:"Email"}),Object(Z.jsx)(G.a.Control,{required:!0,autoComplete:"off",type:"email",name:"email",value:t,onChange:this.userChange,onKeyDown:this.onKeyDown,className:"bg-light",placeholder:"Enter Email"})]}),Object(Z.jsxs)(G.a.Group,{as:W.a,controlId:"formGridpassword",children:[Object(Z.jsx)(G.a.Label,{children:"Password"}),Object(Z.jsx)(G.a.Control,{required:!0,autoComplete:"off",type:"password",name:"password",value:n,onChange:this.userChange,onKeyDown:this.onKeyDown,className:"bg-light",placeholder:"Enter Password"})]}),Object(Z.jsxs)(H.a.Footer,{style:{textAlign:"right"},children:[this.state.loginFail?Object(Z.jsx)(_.a,{children:" Invalid Credentials "},"danger"):Object(Z.jsx)("div",{}),Object(Z.jsxs)(Y.a,{size:"sm",variant:"primary",onClick:this.handleSubmit,children:[Object(Z.jsx)(K.a,{icon:q.e}),"Submit"]})," "]})]})]})})})}}]),n}(a.Component),X=(a.Component,n(4)),$=n(349),ee=n.n($),te=n(254),ne=n(149),ae=n(350),se=n.n(ae),oe=(n(394),s.a.Component,function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).setEditorRef=function(e){return a.editor=e},a.handleScale=function(e){var t=parseFloat(e.target.value);a.setState({scale:t})},a.onCrop=function(){},a.state={image:"",showModal:!1,showImagePickerModal:!0,allowZoomOut:!1,scale:1},a.showImagePicker=a.showImagePicker.bind(Object(U.a)(a)),a.closeImagePicker=a.closeImagePicker.bind(Object(U.a)(a)),a.saveImage=a.saveImage.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"showImagePicker",value:function(){this.setState({showImagePickerModal:!0})}},{key:"closeImagePicker",value:function(e){this.setState({showImagePickerModal:!1}),e&&this.props.setImage(this.state.image)}},{key:"saveImage",value:function(){var e=this.editor.getImageScaledToCanvas().toDataURL();this.props.imageSaved(e),this.props.modalClose()}},{key:"render",value:function(){var e,t=this,n=this.props.image,a=this.props.showModal,s=this.props.modalClose;this.props.setImage;return e=n?125:0,Object(Z.jsx)("div",{children:Object(Z.jsx)(R.a,{children:Object(Z.jsx)(F.a,{className:"justify-content-md-center",children:Object(Z.jsx)(W.a,{md:"auto",children:Object(Z.jsx)(M.a,{style:{marginLeft:"150px",maxWidth:"300px"},show:a,onHide:s,centered:!0,children:Object(Z.jsxs)(R.a,{className:"justify-content-md-center gradientContainer",children:[n?Object(Z.jsxs)("div",{children:[Object(Z.jsx)(F.a,{style:{marginTop:"10px"},className:"justify-content-md-center",children:Object(Z.jsx)(W.a,{md:"auto",children:Object(Z.jsx)(ee.a,{ref:this.setEditorRef,image:n,width:250,height:250,border:2,scale:this.state.scale,borderRadius:e})})}),Object(Z.jsxs)(F.a,{children:[Object(Z.jsx)("br",{}),Object(Z.jsxs)("h1",{style:{color:"white"},children:[Object(Z.jsx)("b",{children:"Zoom"}),":"]}),Object(Z.jsx)("input",{name:"scale",type:"range",onChange:this.handleScale,min:this.state.allowZoomOut?"0.1":"1",max:"2",step:"0.01",defaultValue:"1"})]})]}):Object(Z.jsx)("div",{}),Object(Z.jsx)(F.a,{className:"justify-content-md-center",children:Object(Z.jsx)(W.a,{md:"auto",children:Object(Z.jsx)(te.ImagePicker,{extensions:["jpg","jpeg","png"],dims:{minWidth:100,maxWidth:500,minHeight:100,maxHeight:500},onChange:function(e){console.log("Image chosen:",e),t.state.image=e,t.closeImagePicker(!0)},onError:function(e){console.log("Image error:",e),t.state.image="",t.closeImagePicker(!1)},children:Object(Z.jsx)(Y.a,{color:"secondary",children:"Choose Image"})})})}),Object(Z.jsx)(F.a,{className:"justify-content-md-center",style:{marginTop:"10px",marginBottom:"5px"},children:Object(Z.jsx)(W.a,{md:"auto",children:n?Object(Z.jsx)(Y.a,{class:"secondary",onClick:this.saveImage,children:"Save Image"}):Object(Z.jsx)("div",{})})}),Object(Z.jsx)(F.a,{})]})})})})})})}}]),n}(a.Component)),re=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;Object(P.a)(this,n),(a=t.call(this,e)).initialState={fullname:"",email:"",password:"",password_confirmation:"",registrationSuccess:!1,errors:{}},a.resetUser=function(){a.setState((function(){return a.initialState}))},a.resetErrors=function(){a.setState({errors:{}})},a.createNewUser=function(e){h.a.post("/auth/register",e).then((function(e){j.push({pathname:"/registration",state:a.state.email})})).catch((function(e){console.log("Caught error",e)}))},a.handleChange=function(e){a.setState(Object(B.a)({},e.target.name,e.target.value))},a.userChange=function(e){a.setState(Object(B.a)({},e.target.name,e.target.value))},a.state=a.initialState,a.show=!1,a.message="";e.onClose;return a.handleSubmit=a.handleSubmit.bind(Object(U.a)(a)),a.handleChange=a.handleChange.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"componentWillReceiveProps",value:function(e){e.errors&&this.setState({errors:e.errors})}},{key:"handleSubmit",value:function(e){var t=this.state.image;if(e.preventDefault(),console.log(t),""!==t)try{var n={id:null,name:this.state.fullname,username:this.state.email,password:this.state.password,confirmPassword:this.state.password_confirmation};this.resetErrors(),this.createNewUser(n)}catch(a){console.log(a)}}},{key:"redirectToLogin",value:function(){}},{key:"render",value:function(){var e=this.state,t=e.fullname,n=e.email,a=e.password,s=e.password_confirmation,o=(e.registrationSuccess,e.errors);return Object(Z.jsx)("div",{children:Object(Z.jsx)(H.a,{className:"border border-dark bg-dark text-white",children:Object(Z.jsx)(G.a,{onReset:this.resetUser,onSubmit:this.handleSubmit,id:"userFormId",children:Object(Z.jsxs)(H.a.Body,{children:[Object(Z.jsxs)(G.a.Group,{as:W.a,controlId:"formGridName",children:[Object(Z.jsx)(G.a.Label,{children:"Name"}),Object(Z.jsx)(G.a.Control,{required:!0,autoComplete:"off",type:"text",name:"fullname",value:t,onChange:this.userChange,className:"bg-light",isInvalid:!!o.fullname,placeholder:"Enter Full Name"}),Object(Z.jsx)(G.a.Control.Feedback,{type:"invalid",children:o.fullname})]}),Object(Z.jsxs)(G.a.Group,{as:W.a,controlId:"formGridemail",children:[Object(Z.jsx)(G.a.Label,{children:"Email"}),Object(Z.jsx)(G.a.Control,{required:!0,autoComplete:"off",type:"email",name:"email",value:n,onChange:this.userChange,isInvalid:!!o.username,className:"bg-light",placeholder:"Enter Email (Username)"}),Object(Z.jsx)(G.a.Control.Feedback,{type:"invalid",children:o.username})]}),Object(Z.jsxs)(G.a.Group,{as:W.a,controlId:"formGridpassword",children:[Object(Z.jsx)(G.a.Label,{children:"Password"}),Object(Z.jsx)(G.a.Control,{required:!0,autoComplete:"off",type:"password",name:"password",value:a,onChange:this.userChange,isInvalid:!!o.password,className:"bg-light",placeholder:"Enter Password"}),Object(Z.jsx)(G.a.Control.Feedback,{type:"invalid",children:o.password})]}),Object(Z.jsxs)(G.a.Group,{as:W.a,controlId:"formGridpassword",children:[Object(Z.jsx)(G.a.Label,{children:"Password"}),Object(Z.jsx)(G.a.Control,{required:!0,autoComplete:"off",type:"password",name:"password_confirmation",value:s,onChange:this.userChange,isInvalid:!!o.confirmPassword,className:"bg-light",placeholder:"Re-enter Password"}),Object(Z.jsx)(G.a.Control.Feedback,{type:"invalid",children:o.confirmPassword})]}),Object(Z.jsx)(H.a.Footer,{style:{textAlign:"center"},children:Object(Z.jsx)(R.a,{class:"fluid",children:Object(Z.jsx)("div",{class:"row",children:Object(Z.jsxs)("div",{class:"btn-group-sm btn-group-horizontal",children:[Object(Z.jsxs)(Y.a,{size:"sm",variant:"primary",class:"customWidth",type:"submit",children:[Object(Z.jsx)(K.a,{icon:q.e}),"Submit"]})," ",Object(Z.jsxs)(Y.a,{size:"sm",variant:"primary",class:"customWidth",type:"reset",children:[Object(Z.jsx)(K.a,{icon:q.f}),"Reset"]})]})})})})]})})})})}}]),n}(a.Component),ie=n(262),ce=(n(275),function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).isLoggedIn=!1,a.displayLogin=!0,a.handleClose=a.handleClose.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"handleClose",value:function(){this.setState({})}},{key:"componentDidMount",value:function(){var e=this;C.currentUser.subscribe((function(t){t&&null!==t.getCurrentUserValue&&(e.isLoggedIn=!0)}))}},{key:"render",value:function(){var e=this.props,t=e.show,n=e.displayLogin,a=e.onHide;this.state;return Object(Z.jsxs)(M.a,{show:t,onHide:a,children:[Object(Z.jsx)(M.a.Header,{closeButton:!0,children:Object(Z.jsx)(M.a.Title,{children:n?Object(Z.jsxs)("div",{children:[" ",Object(Z.jsx)(ie.b,{})," SignIn "]}):Object(Z.jsxs)("div",{children:[" ",Object(Z.jsx)(ie.a,{})," Register "]})})}),Object(Z.jsx)(M.a.Body,{children:n?Object(Z.jsx)(Q,{}):Object(Z.jsx)(re,{})})]})}}]),n}(a.Component)),le=n(87),ue=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={isOpen:!1,displayLogin:!0,displayDropdown:!1,name:"",avatar:""},a.toggle=a.toggle.bind(Object(U.a)(a)),a.loginLinkName="Login",a.isDlgOpen=!1,a.logout=a.logout.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.subscriptionLogOut=C.currentUser.subscribe((function(t){console.log("Logout?",t),null===t&&e.setState({name:"",displayDropdown:!1})})),this.subscriptionProfileDropdown=O.currentName.subscribe((function(t){console.log("checking profile dropdown name",t),"undefined"!==t&&t||(t=O.currentNameValue),t&&(console.log("currentName Observable Triggered",t),e.setState({name:t,displayDropdown:!0}))})),this.subscriptionImageSet=x.currentImage.subscribe((function(t){!0===C.loggedIn&&("undefined"!==t&&t||(t=x.currentImageValue),e.setState({avatar:t}))}))}},{key:"componentWillUnmount",value:function(){this.subscriptionProfileDropdown.unsubscribe(),this.subscriptionImageSet.unsubscribe(),this.subscriptionLogOut.unsubscribe()}},{key:"toggle",value:function(){this.setState({isOpen:!this.state.isOpen})}},{key:"logout",value:function(){C.logout(),j.push("/")}},{key:"render",value:function(){var e=this.state.name,t=this.state.avatar;return Object(Z.jsxs)(E.a,{color:"light",expand:"md",class:"px-2",children:[Object(Z.jsx)(T.a,{style:{fontSize:"50px",fontFamily:"Arial"},children:"ReactApp"}),e?Object(Z.jsx)(A.a,{className:"ms-auto",style:{marginRight:"20px"},children:Object(Z.jsx)(R.a,{children:Object(Z.jsxs)(F.a,{children:[Object(Z.jsx)(W.a,{style:{marginRight:"10px"},children:t?Object(Z.jsx)(le.a,{round:!0,size:"40",name:e,src:t}):e?Object(Z.jsx)(le.a,{size:"40",round:!0,name:e}):Object(Z.jsx)("div",{})}),Object(Z.jsx)(W.a,{children:this.state.displayDropdown?Object(Z.jsxs)(J.a,{class:"px-20",children:[Object(Z.jsxs)(J.a.Toggle,{variant:"success",children:[" Welcome, ",e," "]}),Object(Z.jsxs)(J.a.Menu,{children:[Object(Z.jsx)(J.a.Item,{children:Object(Z.jsx)(z.a,{to:"/posts",children:"View Posts"})}),Object(Z.jsx)(J.a.Item,{children:Object(Z.jsx)(z.a,{to:"/profile",children:"View/Edit Profile"})}),Object(Z.jsx)(J.a.Item,{children:"Contact Us"}),Object(Z.jsx)(J.a.Item,{onClick:this.logout,children:"Logout"})]})]}):Object(Z.jsx)("div",{})})]})})}):Object(Z.jsx)("div",{})]})}}]),n}(a.Component),de=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).onCloseDlg=function(){a.setState({show:!1})},a.state={show:!1,displayLogin:!1},a.openLoginDlg=a.openLoginDlg.bind(Object(U.a)(a)),a.openRegisterDlg=a.openRegisterDlg.bind(Object(U.a)(a)),a.onCloseDlg=a.onCloseDlg.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"openLoginDlg",value:function(){this.setState({show:!0,displayLogin:!0})}},{key:"openRegisterDlg",value:function(){this.setState({show:!0,displayLogin:!1})}},{key:"render",value:function(){var e=this.state,t=e.show,n=e.displayLogin;return console.log("Landing Component",t,n),Object(Z.jsxs)("div",{children:[Object(Z.jsx)(ce,{show:t,displayLogin:n,onHide:this.onCloseDlg}),Object(Z.jsxs)(W.a,{style:{position:"absolute",bottom:"0"},children:[Object(Z.jsx)(F.a,{children:Object(Z.jsx)(W.a,{className:"text-center",children:Object(Z.jsx)(Y.a,{className:"btn-primary",onClick:this.openLoginDlg,children:"Login"})})}),Object(Z.jsx)(F.a,{children:Object(Z.jsx)(W.a,{className:"text-center",children:Object(Z.jsx)(Y.a,{className:"link-style btn-secondary",style:{outline:"none"},onClick:this.openRegisterDlg,children:"Don't have an account? Register Here.."})})})]})]})}}]),n}(a.Component),me=n.p+"static/media/alpinelake_bg.d1f3d6dc.jpg",he=function(){return Object(Z.jsx)("div",{children:Object(Z.jsx)("div",{className:"p5 mb-4 rounded-3",style:{backgroundImage:"url(".concat(me,")"),backgroundSize:"cover"},children:Object(Z.jsxs)(R.a,{style:{position:"relative",maxWidth:"100vw",maxHeight:"40vw",height:"40vw"},children:[Object(Z.jsx)(F.a,{className:"text-center justify-content-center d-flex",children:Object(Z.jsx)("h1",{className:"display-5",children:"Landing Page"})}),Object(Z.jsx)(F.a,{className:"items-align",children:Object(Z.jsx)(de,{})})]})})})},pe=n(9);function je(){var e=C.currentUserValue;return console.log("authHeader",e.token),e&&e.token?"Bearer ".concat(e.token):{}}var be=n(30),ge=n(206),fe=n(205),Oe=n.n(fe),ve=n(129),xe=n.n(ve),ye=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={posts:[]},a.remove=a.remove.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"remove",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.delete("/api/posts/".concat(t),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:je()}}).then((function(e){n.props.updatePosts()}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.isLoading,n=this.props.posts;console.log("Posts",n);var a=this.props.role;if(t)return Object(Z.jsx)("p",{children:"Loading..."});var s=n.map((function(t){var n=Object(ge.a)(Object(be.convertFromRaw)(JSON.parse(t.body))),s=new Date(1e3*t.modifiedAt),o=s.toLocaleDateString("en-US",{month:"long"})+", "+xe()(s).format("Do, YYYY, h:mm a");return Object(Z.jsx)("div",{children:Object(Z.jsxs)("article",{class:"blog-post",children:["ROLE_ADMIN"===a?Object(Z.jsxs)(pe.b,{children:[Object(Z.jsxs)(pe.a,{size:"sm",color:"primary",children:[" ",Object(Z.jsx)(z.a,{to:{pathname:"posts/edit/",state:{params:{id:t.id}}},children:"Edit"})]}),Object(Z.jsx)(pe.a,{size:"sm",color:"danger",onClick:function(){return e.remove(t.id)},children:"Delete"})]}):Object(Z.jsx)("div",{}),Object(Z.jsx)("h2",{class:"blog-post-title",children:Object(Z.jsx)(z.a,{to:{pathname:"posts/view/",state:{params:{id:t.id}}},children:t.title})}),Object(Z.jsx)("p",{class:"blog-post-meta",children:o}),Object(Z.jsx)("p",{children:Oe()(n)})]})})}));return console.log(s),Object(Z.jsx)("div",{children:s})}}]),n}(a.Component),Ce=ye,Se={currentPage:1,itemsPerPage:3,itemCount:0,totalPages:1,getCurrentStartIndex:function(){return Se.itemsPerPage*(Se.currentPage-1)},getCurrentEndIndex:function(){return Se.itemsPerPage*Se.currentPage-1},goToNextPage:function(){Se.currentPage<Se.totalPages&&Se.currentPage++},goToPrevPage:function(){Se.currentPage>1&&Se.currentPage--},setItemCount:function(e){Se.itemCount=e},setTotalPages:function(){0===Se.itemCount?Se.totalPages=1:Se.totalPages=Math.ceil(Se.itemCount/Se.itemsPerPage)}};var we=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).state={role:"ROLE_GUEST",posts:[],currentPage:[]},a.subscriptionRole=null,a.goToNextPage=a.goToNextPage.bind(Object(U.a)(a)),a.goToPrevPage=a.goToPrevPage.bind(Object(U.a)(a)),a.updatePagination=a.updatePagination.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"componentWillMount",value:function(){var e=this;this.subscriptionRole=O.currentRole.subscribe((function(t){t&&(console.log("Getting observable role",t),e.setState({role:t}))}))}},{key:"componentDidMount",value:function(){var e=this,t=C.verifyLogin();console.log("Posts componentDidMount",t),t&&t.then((function(t){localStorage.getItem("currentUser")&&(console.log("Posts componentDidMount re-render"),e.setState({role:O.currentRoleValue}))})),h.a.get("api/posts",{headers:{Authorization:je()}}).then((function(t){console.log(t.data);var n=t.data;e.state.posts=n})).then((function(t){e.state.posts=e.state.posts.sort((function(e,t){return e.modifiedAt<t.modifiedAt?1:-1})),Se.setItemCount(e.state.posts.length),Se.setTotalPages(),console.log(Se.totalPages),e.setState({currentPage:e.getCurrentPage()})}))}},{key:"updatePagination",value:function(){var e=this,t=[];h.a.get("api/posts",{headers:{Authorization:je()}}).then((function(e){console.log(e.data),t=e.data})).then((function(){Se.setItemCount(t.length),Se.setTotalPages(),Se.currentPage=1,e.setState({posts:t,currentPage:e.getCurrentPage()})}))}},{key:"componentWillUnmount",value:function(){this.subscriptionRole.unsubscribe()}},{key:"goToNextPage",value:function(){Se.goToNextPage(),this.setState({currentPage:this.getCurrentPage()})}},{key:"goToPrevPage",value:function(){Se.goToPrevPage(),this.setState({currentPage:this.getCurrentPage()})}},{key:"getCurrentPage",value:function(){return console.log("CurrentPage",Se.currentPage),this.state.posts.slice(Se.getCurrentStartIndex(),Se.getCurrentEndIndex()+1)}},{key:"isLastPage",value:function(){return Se.currentPage===Se.totalPages}},{key:"isFirstPage",value:function(){return 1===Se.currentPage}},{key:"render",value:function(){var e=this.state.role.roleName,t=this.state.currentPage,n=this.isFirstPage(),a=this.isLastPage();return console.log("CurrentPage",t),Object(Z.jsx)("div",{children:Object(Z.jsxs)(pe.i,{fluid:!0,children:[Object(Z.jsxs)(pe.n,{children:["ROLE_ADMIN"===e?Object(Z.jsx)("div",{className:"float-right",children:Object(Z.jsx)(pe.a,{color:"success",children:Object(Z.jsx)(z.a,{to:{pathname:"posts/edit/",state:{params:{id:"new"}}},children:"Add Post"})})}):Object(Z.jsx)("div",{}),Object(Z.jsx)("h3",{children:"Posts"}),Object(Z.jsx)("div",{className:"col-md-8",children:Object(Z.jsx)(Ce,{updatePosts:this.updatePagination,posts:t,role:e})})]}),1!==Se.totalPages?Object(Z.jsxs)(pe.n,{children:[Object(Z.jsx)(pe.h,{children:Object(Z.jsx)(pe.a,{color:"primary",disabled:n,onClick:this.goToPrevPage,children:Object(Z.jsx)(K.a,{icon:q.c})})}),Object(Z.jsx)(pe.h,{children:Object(Z.jsx)(pe.a,{color:"primary",disabled:a,onClick:this.goToNextPage,children:Object(Z.jsx)(K.a,{icon:q.d})})})]}):Object(Z.jsx)("div",{})]})})}}]),n}(a.Component),ke=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).setDomEditorRef=function(e){return a.domEditor=e},a.handleKeyCommand=a.handleKeyCommand.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"componentDidMount",value:function(){this.props.editorState&&this.props.onChange&&this.domEditor.focus()}},{key:"handleKeyCommand",value:function(e,t){var n=be.RichUtils.handleKeyCommand(t,e);return n?(this.props.onChange(n),"handled"):"not-handled"}},{key:"render",value:function(){var e=this.props,t=e.editorState,n=e.onChange;return Object(Z.jsx)("div",{style:{borderRadius:"5px",border:"1px solid lightgrey",minHeight:"6em",cursor:"text"},children:Object(Z.jsx)(be.Editor,{ref:this.setDomEditorRef,editorState:t,handleKeyCommand:this.handleKeyCommand,onChange:n})})}}]),n}(a.Component),Ie=(n(581),n(582),function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).onChangeRichTextEditor=function(e){a.setState({editorState:e})},a.setImage=function(e){a.setState({image:e})},a.imageSaved=function(e){a.setState({image:e,postImage:!0})},a.profile={username:"",name:"",heading:"",body:"",imageUrl:""},a.state={id:"",profile:a.profile,image:"",editorState:be.EditorState.createEmpty(),showModal:!1,postImage:!1,updateEditor:!1,contentLoaded:!1},a.initialFormState={name:"",heading:"",body:"",imageUrl:""},a.username=C.getUsernameFromJWT(),a.submitDisabled=!0,a.handleChange=a.handleChange.bind(Object(U.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(U.a)(a)),a.displayAvatarEditor=a.displayAvatarEditor.bind(Object(U.a)(a)),a.closeAvatarEditor=a.closeAvatarEditor.bind(Object(U.a)(a)),a.imageSaved=a.imageSaved.bind(Object(U.a)(a)),a.postImagetoImgBB=a.postImageToImgBB.bind(Object(U.a)(a)),a.getBase64Image=a.getBase64Image.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"handleSubmit",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),(n=C.verifyLogin())&&(this.submitDisabled=!0,n.then((function(e){if(localStorage.getItem("currentUser")){var t=a.state,n=t.id,s=(t.profile,t.image,t.editorState,t.showModal,t.postImage),o=a.state.image;if(console.log("submitting profile info",a.state),o&&s){(i={id:n,name:a.profile.name,profileHeading:a.profile.heading,profileInfo:null,avatar:{username:a.profile.username,strBase64File:o}}).profileInfo=JSON.stringify(Object(be.convertToRaw)(a.state.editorState.getCurrentContent()));var r=JSON.stringify(i);h.a.put("/api/clients/".concat(i.id),r,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:je()}}).then((function(e){x.setImage(a.state.image),j.push("/posts")})).catch((function(e){return console.log(e)}))}else{var i;(i={id:n,name:a.profile.name,profileHeading:a.profile.heading,profileInfo:null,avatar:null}).profileInfo=JSON.stringify(Object(be.convertToRaw)(a.state.editorState.getCurrentContent()));var c=JSON.stringify(i);h.a.put("/api/clients/".concat(i.id),c,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:je()}}).then((function(e){j.push("/posts")})).catch((function(e){return console.log(e)}))}}})),this.setState({}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getClient",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="",e.next=3,h.a.get("/api/clients/getByUsername/".concat(this.username),{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:je()}}).then((function(e){t=e.data})).catch((function(e){console.log("ProfileEdit Error",e)}));case 3:this.initialFormState={name:t.name,heading:t.profileHeading,body:t.profileInfo},this.profile={username:t.username,name:t.name,heading:t.profileHeading,body:t.profileInfo},""===x.currentImageValue?t.avatar?this.profile.imageUrl=t.avatar.strBase64File:this.profile.imageUrl="":this.profile.imageUrl=x.currentImageValue,n=this.state.editorState,this.profile.body&&(n=be.EditorState.createWithContent(Object(be.convertFromRaw)(JSON.parse(this.profile.body)))),this.setState({id:t.id,profile:this.profile,editorState:n,image:this.profile.imageUrl,contentLoaded:!0});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){localStorage.getItem("currentUser")&&this.getClient()}},{key:"handleChange",value:function(e){var t=e.target,n=t.value,a=t.name,s=this.profile;s[a]=n,this.setState({profile:s})}},{key:"checkFormState",value:function(){var e="",t="",n="",a="",s="",o="";return this.state.profile.name&&(e=this.state.profile.name),this.state.profile.heading&&(t=this.state.profile.heading),this.state.profile.body&&(n=JSON.stringify(Object(be.convertToRaw)(this.state.editorState.getCurrentContent()))),this.state.profile.imageUrl&&this.state.profile.imageUrl,this.initialFormState.name&&(a=this.initialFormState.name),this.initialFormState.heading&&(s=this.initialFormState.heading),this.initialFormState.body&&(o=this.initialFormState.body),this.initialFormState.imageUrl&&this.initialFormState.imageUrl,!this.state.postImage&&(e===a&&t===s&&n===o)}},{key:"displayAvatarEditor",value:function(){this.setState({showModal:!0})}},{key:"closeAvatarEditor",value:function(){this.setState({showModal:!1})}},{key:"postImageToImgBB",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a,s=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"cfb81278dab11ed393283f39d4119f59","https://api.imgbb.com/1/upload",n=t.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""),(a=new FormData).append("image",n),e.next=7,h.a.post("https://api.imgbb.com/1/upload",a,{params:{key:"cfb81278dab11ed393283f39d4119f59"}}).then((function(e){var t=e.data.data.url,n=s.state.profile;n.imageUrl=t,s.setState({profile:n})})).catch((function(e){return console.log(e)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBase64Image",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.get("/api/clients/getById/".concat(t),{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:je()}}).then((function(e){return e.data.iconUrl}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=(e.id,e.profile),n=e.image,a=(e.editorState,e.showModal),s=(e.postImage,e.contentLoaded);return console.log("ProfileEdit Render",this.state),this.submitDisabled=this.checkFormState(),Object(Z.jsx)("div",{children:s?Object(Z.jsxs)("div",{children:[Object(Z.jsx)(oe,{image:n,showModal:a,modalClose:this.closeAvatarEditor,setImage:this.setImage,imageSaved:this.imageSaved}),Object(Z.jsxs)(pe.i,{children:[Object(Z.jsx)("h1",{children:"Edit Profile"}),Object(Z.jsxs)(pe.j,{onSubmit:this.handleSubmit,children:[Object(Z.jsxs)(pe.k,{children:[Object(Z.jsx)(pe.m,{for:"name",children:Object(Z.jsx)("strong",{children:"Name"})}),Object(Z.jsx)(pe.l,{style:{maxWidth:"250px"},type:"text",name:"name",id:"name",value:t.name,onChange:this.handleChange,autoComplete:"name"})]}),Object(Z.jsxs)(pe.k,{children:[Object(Z.jsx)(pe.m,{for:"heading",children:Object(Z.jsx)("strong",{children:"Heading"})}),Object(Z.jsx)(pe.l,{type:"text",name:"heading",id:"heading",value:t.heading,onChange:this.handleChange,autoComplete:"heading"})]}),Object(Z.jsxs)(pe.k,{children:[Object(Z.jsx)(pe.m,{for:"body",children:Object(Z.jsx)("strong",{children:"Profile Info"})}),Object(Z.jsx)(ke,{editorState:this.state.editorState,onChange:this.onChangeRichTextEditor})]}),Object(Z.jsx)(pe.k,{children:Object(Z.jsxs)(pe.i,{children:[Object(Z.jsx)(pe.n,{children:Object(Z.jsx)(pe.m,{for:"Icon",children:Object(Z.jsx)("strong",{children:"Profile Icon"})})}),Object(Z.jsx)(pe.n,{children:n?Object(Z.jsx)(le.a,{round:!0,borderRadius:"50",size:"100",name:n,src:n}):Object(Z.jsx)(le.a,{size:"100",round:!0,name:t.name})}),Object(Z.jsx)(pe.n,{children:Object(Z.jsx)(pe.a,{style:{marginTop:"10px",maxWidth:"200px"},color:"primary",onClick:this.displayAvatarEditor,children:"Choose Icon"})})]})}),Object(Z.jsxs)(pe.k,{children:[Object(Z.jsx)(pe.a,{disabled:this.submitDisabled,color:"primary",type:"submit",children:"Update Profile"})," ",Object(Z.jsx)(pe.a,{color:"secondary",tag:z.a,to:"/posts",children:"Cancel"})]})]})]})]}):Object(Z.jsx)("div",{})})}}]),n}(a.Component)),Pe=Ie;function Ve(){return(Ve=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.verifyLogin();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var De=function(){var e=Object(a.useState)(!0),t=Object(i.a)(e,2),n=t[0],s=t[1],o=function(){return Ve.apply(this,arguments)}();return"DONE"===o?s(!1):o&&o.then((function(e){var t=e;console.log("Promise resolved?",t),localStorage.getItem("currentUser")&&s(!1)})),n?Object(Z.jsx)("div",{}):Object(Z.jsx)("div",{children:Object(Z.jsx)(R.a,{style:{position:"relative",maxWidth:"100vw",maxHeight:"40vw",height:"40vw"},children:Object(Z.jsx)(Pe,{})})})},Ne=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(V.a)(n,[{key:"openDlg",value:function(){j.push("/")}},{key:"render",value:function(){var e=this.props.location.state;return console.log(e),void 0===e?(j.push("/"),null):Object(Z.jsx)("div",{children:Object(Z.jsxs)(pe.i,{children:[Object(Z.jsx)("div",{class:"row",children:Object(Z.jsxs)("div",{class:"col text-center",children:["Sign-up successful, please check email sent to ",Object(Z.jsx)("b",{children:e})," to finish registration process.."]})}),Object(Z.jsx)("div",{class:"row",children:Object(Z.jsx)("div",{class:"col text-center",children:Object(Z.jsx)(pe.a,{className:"btn-primary center",onClick:this.openDlg,children:" Proceed "})})})]})})}}]),n}(a.Component),Le=Ne,Ue=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).emptyItem={title:"",body:""},a.onChangeRichTextEditor=function(e){a.setState({editorState:e})},a.state={id:"",value:"",item:a.emptyItem,editorState:be.EditorState.createEmpty()},a.handleChange=a.handleChange.bind(Object(U.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.id=this.props.location.state.params.id,"DONE"!==(n=C.verifyLogin())){e.next=8;break}if("new"===this.state.id){e.next=6;break}return e.next=6,h.a.get("/api/posts/".concat(this.state.id),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:je()}}).then((function(e){t=e.data,a.setState({item:t,editorState:be.EditorState.createWithContent(be.ContentState.createFromText(t.body))})}));case 6:e.next=9;break;case 8:n&&n.then((function(e){localStorage.getItem("currentUser")&&"new"!==a.state.id&&h.a.get("/api/posts/".concat(a.state.id),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:je()}}).then((function(e){t=e.data;var n=be.EditorState.createWithContent(Object(be.convertFromRaw)(JSON.parse(t.body)));a.setState({item:t,editorState:n})}))}));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleChange",value:function(e){var t=e.target,n=t.value,a=t.name,s=Object(X.a)({},this.state.item);s[a]=n,this.setState({item:s})}},{key:"handleSubmit",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=this.state,a=n.item,n.editorState,a.body=JSON.stringify(Object(be.convertToRaw)(this.state.editorState.getCurrentContent())),console.log(a),e.next=6,fetch("/api/posts"+(a.id?"/"+a.id:""),{method:a.id?"PUT":"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:je()},body:JSON.stringify(a)});case 6:this.props.history.push("/posts");case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(Z.jsx)("h2",{children:this.state.item.id?"Edit Post":"New Post"});return Object(Z.jsx)("div",{children:Object(Z.jsxs)(pe.i,{children:[e,Object(Z.jsxs)(pe.j,{onSubmit:this.handleSubmit,children:[Object(Z.jsxs)(pe.k,{children:[Object(Z.jsx)(pe.m,{for:"title",children:"Title"}),Object(Z.jsx)(pe.l,{type:"text",name:"title",id:"title",value:this.state.item.title||"",onChange:this.handleChange,autoComplete:"title"})]}),Object(Z.jsxs)(pe.k,{children:[Object(Z.jsx)(pe.m,{for:"body",children:"Body"}),this.onChangeRichTextEditor?Object(Z.jsx)(ke,{editorState:this.state.editorState,onChange:this.onChangeRichTextEditor}):Object(Z.jsx)("div",{})]}),Object(Z.jsxs)(pe.k,{children:[Object(Z.jsx)(pe.a,{color:"primary",type:"submit",children:"Save"})," ",Object(Z.jsx)(pe.a,{color:"secondary",tag:z.a,to:"/posts",children:"Cancel"})]})]})]})})}}]),n}(a.Component),Ee=Ue,Te=(n(344),n(3)),Ae=n.n(Te),Re=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;Object(P.a)(this,n),(a=t.call(this,e)).onExpand=function(){a.state.isExpanded||(a.outerHeight=document.scrollHeight,a.setState({isExpanded:!0}))};return a.state={isExpanded:!1},a.onExpand=a.onExpand.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"render",value:function(){var e=this.props,t=e.commentValue,n=e.handleCommentValue,a=(e.enterCommentLine,e.submitCommentLine),s=e.onClose,o=e.isExpanded;this.state.isExpanded=o;return Object(Z.jsxs)("form",{onSubmit:a,onChange:n,className:Ae()("comment-box",{expanded:o,collapsed:!o,modified:t.length>0}),style:{minHeight:o?this.outerHeight:46},children:[Object(Z.jsx)("div",{className:"header headerComment",children:Object(Z.jsxs)("div",{className:"user",children:[Object(Z.jsx)("img",{src:"avatar/path",alt:"User avatar"}),Object(Z.jsx)("span",{children:"User Name"})]})}),Object(Z.jsx)("div",{className:"header headerComment",children:" ... "}),Object(Z.jsx)("label",{className:"label labelComment",htmlFor:"comment",children:"What are your thoughts?"}),Object(Z.jsx)("textarea",{onClick:this.onExpand,onFocus:this.onExpand,onChange:n,className:"comment-field",placeholder:"What are your thoughts?",value:t,name:"comment",id:"comment"}),Object(Z.jsxs)("div",{className:"actions",children:[Object(Z.jsx)("button",{type:"button",className:"cancel",onClick:s,children:"Cancel"}),Object(Z.jsx)("button",{type:"submit",disabled:t.length<1,children:"Enter"})]})]})}}]),n}(a.Component),Fe=n(628),We=n(345),Je=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).commentListSorted=null,a.state={isLoading:!0,commentCount:0,upVotes:0,downVotes:0,isUpVotingDisabled:!1,isDownVotingDisabled:!1},a.commentList=null,a}return Object(V.a)(n,[{key:"tallyVotes",value:function(e){var t=0,n=0;return e&&e.length>0&&e.forEach((function(e){"UP"===e.voteType?t++:"DOWN"===e.voteType&&n++})),console.log("Tallying votes",t,n),{upVoteCount:t,downVoteCount:n}}},{key:"refreshCommentList",value:function(){var e=this,t=this.props,n=t.role,a=t.comments,s=t.incrementDownVote,o=t.incrementUpVote,r=t.upVoteDisabled,i=t.downVoteDisabled,c=t.icons,l=t.removeComment;t.count,t.currentUsername;console.log("Comment list properties",this.props),console.log("Refreshing the comment component",a,c,n),this.commentListSorted=a.sort((function(e,t){return e.createdAt<t.createdAt?-1:1}));this.commentList=this.commentListSorted.map((function(t){var a=new Date(1e3*t.createdAt),u=a.toLocaleDateString("en-US",{month:"long"})+", "+xe()(a).format("Do, YYYY, h:mm a");console.log("current comment in list",t,c[t.posterUsername]);var d=e.tallyVotes(t.votes),m=d.upVoteCount,h=d.downVoteCount;return console.log("UpVotes",m),console.log("DownVotes",h),Object(Z.jsx)("div",{children:Object(Z.jsxs)(R.a,{children:[Object(Z.jsx)(F.a,{children:t.commentText?Object(Z.jsxs)(Fe.a.Item,{children:[c[t.posterUsername]?Object(Z.jsx)(le.a,{round:!0,borderRadius:"50",size:"50",name:t.posterName,src:c[t.posterUsername]}):Object(Z.jsx)(le.a,{size:"50",round:!0,name:t.posterName}),t.commentName,Object(Z.jsx)("br",{}),u,Object(Z.jsx)("br",{}),t.commentText]}):Object(Z.jsx)("div",{})}),Object(Z.jsx)(F.a,{alignItems:"flex-end",children:Object(Z.jsxs)(W.a,{children:[Object(Z.jsx)(Y.a,{disabled:r[t.id],size:"sm",color:"primary",onClick:function(){return o(t.id)},children:Object(Z.jsx)(K.a,{icon:q.b})}),Object(Z.jsxs)(We.a,{children:[" ",0!==m?m:" "]}),Object(Z.jsx)(Y.a,{disabled:i[t.id],size:"sm",color:"primary",onClick:function(){return s(t.id)},children:Object(Z.jsx)(K.a,{icon:q.a})}),Object(Z.jsxs)(We.a,{children:[" ",0!==h?h:" "," "]})]})}),Object(Z.jsx)(F.a,{children:Object(Z.jsx)(W.a,{children:"ROLE_ADMIN"===n?Object(Z.jsx)(Y.a,{size:"sm",color:"danger",onClick:function(){return l(t.id)},children:"Delete"}):Object(Z.jsx)("div",{})})})]})})}))}},{key:"componentDidMount",value:function(){this.refreshCommentList(),this.setState({isLoading:!1,commentCount:this.commentList.length})}},{key:"render",value:function(){return this.refreshCommentList(),this.state.isLoading?Object(Z.jsx)("div",{}):Object(Z.jsx)(R.a,{children:Object(Z.jsx)(Fe.a,{children:this.commentList})})}}]),n}(a.Component),ze=1,Me=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(e){var a;return Object(P.a)(this,n),(a=t.call(this,e)).emptyItem={title:"",date:"",body:""},a.handleCommentValue=function(e){a.setState({commentValue:e.target.value})},a.submitCommentLine=function(e){e.preventDefault(),a.setCommentLine()},a.enterCommentLine=function(e){13===e.charCode&&a.setCommentLine()},a.onCommentClose=function(){a.setState({commentValue:"",isExpanded:!1})},a.currentRole="ROLE_GUEST",a.state={title:"",date:"",body:"",commentValue:"",comments:[],icons:{},currentCount:ze,votes:{},usersVoted:{},upVoteDisabled:{},downVoteDisabled:{},username:"",isExpanded:!1,isLoading:!0},a.handleCommentValue=a.handleCommentValue.bind(Object(U.a)(a)),a.enterCommentLine=a.enterCommentLine.bind(Object(U.a)(a)),a.submitCommentLine=a.submitCommentLine.bind(Object(U.a)(a)),a.onCommentClose=a.onCommentClose.bind(Object(U.a)(a)),a.setCommentLine=a.setCommentLine.bind(Object(U.a)(a)),a.removeComment=a.removeComment.bind(Object(U.a)(a)),a.incrementUpVote=a.incrementUpVote.bind(Object(U.a)(a)),a.incrementDownVote=a.incrementDownVote.bind(Object(U.a)(a)),a.updateUserVoted=a.updateUserVoted.bind(Object(U.a)(a)),a}return Object(V.a)(n,[{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.state.username=C.getUsernameFromJWT(),(t=C.verifyLogin())&&t.then((function(e){localStorage.getItem("currentUser")&&n.getPostAndComments()}));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPostAndComments",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,a,s,o,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentRole=O.currentRoleValue.roleName,t={title:"",date:"",body:"",comments:{},icons:{},currentCount:0,votes:{},usersVoted:{},upVoteDisabled:{},downVoteDisabled:{}},e.next=4,h.a.get("/api/posts/".concat(this.props.location.state.params.id),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:je()}}).then((function(e){t.title=e.data.title,t.date=e.data.modifiedAt,t.body=e.data.body,t.comments=e.data.comments,console.log(t.comments)})).catch((function(e){console.log(e)}));case 4:if(t.comments&&null===t.comments[0]&&t.comments.pop(),!t.comments||!t.comments[0]){e.next=17;break}return n=new Set,new Set,t.comments.map((function(e){t.currentCount++,t.votes[e.id]=e.votes,t.usersVoted[e.id]={},null!==e.usersVoted&&Object.keys(e.usersVoted).length>=0?t.usersVoted[e.id]=e.usersVoted[e.id]:t.usersVoted[e.id][e.posterUsername]=!1,n.add(e.posterUsername)})),t.comments.forEach((function(e){t.upVoteDisabled[e.id]=!1,t.downVoteDisabled[e.id]=!1,e.votes&&e.votes.forEach((function(n){n.username===r.state.username&&("UP"===n.voteType?t.upVoteDisabled[e.id]=!0:"DOWN"===n.voteType&&(t.downVoteDisabled[e.id]=!0))}))})),a=Array.from(n),s=0,console.log(a),e.next=15,a.forEach((function(e){h.a.get("/api/getImage/".concat(e),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:je()}}).then((function(e){if(e.data){console.log("image received",e.data);var n=e.data.username;t.icons[n]=e.data.strBase64File}++s===a.length&&(ze=t.currentCount,r.setState({title:t.title,date:t.date,body:t.body,comments:t.comments,icons:t.icons,currentCount:t.currentCount,upVoteDisabled:t.upVoteDisabled,downVoteDisabled:t.downVoteDisabled,isLoading:!1}))}))}));case 15:e.next=23;break;case 17:o=x.currentImageValue,t.icons[o.username]=o.strBase64File,ze=t.currentCount,null,null,this.setState({title:t.title,date:t.date,body:t.body,comments:t.comments,icons:t.icons,votes:null,usersVoted:null,currentCount:t.currentCount,isLoading:!1});case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"incrementUpVote",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Attempting to increment vote for",this.state.username,t),n={id:null,postId:this.props.location.state.params.id,commentId:t,username:this.state.username,voteType:"UP"},this.state.comments=this.updateCommentsWithVote(n),e.next=5,this.setCommentWithVotes(t);case 5:this.state.upVoteDisabled[t]=!0,this.state.downVoteDisabled[t]=!1,this.setState({});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"incrementDownVote",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Attempting to decrement vote for",this.state.username,t),n={id:null,postId:this.props.location.state.params.id,commentId:t,username:this.state.username,voteType:"DOWN"},this.state.comments=this.updateCommentsWithVote(n),e.next=5,this.setCommentWithVotes(t);case 5:this.state.upVoteDisabled[t]=!1,this.state.downVoteDisabled[t]=!0,this.setState({});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateCommentsWithVote",value:function(e){var t,n=this,a=[],s=!1;return this.state.comments.forEach((function(t){t.id===e.commentId&&(t.votes&&t.votes.forEach((function(t){t.username===n.state.username?(a.push(e),s=!0):a.push(t)})),s||a.push(e))})),console.log("Before updating votes",this.state.comments,a),t=this.state.comments.map((function(t){return console.log("Current comment",t),t.id===e.commentId&&(t.votes=a),t})),console.log("After updating votes",t,a),t}},{key:"updateUserVoted",value:function(e,t){this.state.usersVoted[e][this.state.username]=t}},{key:"setCommentWithVotes",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,this.state.comments.forEach((function(e){e.id===t&&(n=e)})),e.next=4,this.submitComment(n);case 4:a=e.sent,{id:a.id,posterName:a.posterName,posterUsername:a.posterUsername,createdAt:a.createdAt,commentText:a.commentText,votes:a.votes[a.id],usersVoted:a.usersVoted},this.state.comments&&(s=this.state.comments.findIndex((function(e){return e.id===t})),s>=0?(this.state.comments.splice(s,1),this.state.comments.push(a)):this.state.comments.push(a)),Object.keys(this.state.votes)>0||(this.state.votes={}),this.state.votes[t]=a.votes,Object.keys(this.state.usersVoted)>0||(this.state.usersVoted={}),this.state.usersVoted[t]=a.usersVoted,this.setState({commentValue:""});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setComment",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ze++,t={id:null,postId:this.props.match.params.id,posterName:O.currentNameValue,posterUsername:C.getUsernameFromJWT(),commentText:this.state.commentValue,votes:null,usersVoted:null},e.next=4,this.submitComment(t);case 4:n=e.sent,a={id:n.id,posterName:n.posterName,posterUsername:n.posterUsername,createdAt:n.createdAt,commentText:n.commentText,votes:n.votes,usersVoted:n.usersVoted},this.state.comments||(this.state.comments=[]),this.state.comments.push(a),this.state.votes||(this.state.votes={}),this.state.votes[a.id]=null,s=x.currentImageValue,this.state.icons[n.posterUsername]=s,console.log("usersVoted Undefined setComment Function?",this.state.usersVoted),null!=this.state.usersVoted&&"undefined"!==typeof this.state.usersVoted||(this.state.usersVoted={},this.state.usersVoted[a.id]={},this.state.usersVoted[a.id][this.state.username]=!1),console.log("usersVoted after bsetComment Function?",this.state.usersVoted),this.setState({commentValue:""});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setCommentLine",value:function(){var e=this,t=C.verifyLogin();t?t.then((function(t){localStorage.getItem("currentUser")&&e.setComment()})):console.log("Could not verify login credentials"),console.log("Upon comment submit",this.state.comments)}},{key:"submitComment",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="",a=JSON.stringify(t),console.log("Comment to put",a),e.next=5,h()({method:"post",url:"/api/posts/comments/".concat(this.props.location.state.params.id),data:a,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:je()}}).then((function(e){n=e.data})).catch((function(e){console.log("PutComment error",e)}));case 5:return console.log("SubmitComment",n),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIconImage",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.get("/api/getImage/".concat(t),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:je()}}).then((function(e){return e.data.strBase64File}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeComment",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a,s,o=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.comments,0,a=0,s=0,n.forEach((function(e){e.id===t&&(s=a),a++})),!(a>=0)){e.next=12;break}return 1===n.length?n=[]:n.splice(s,1),ze--,e.next=10,h.a.delete("/api/posts/comments/".concat(t),{headers:{Authorization:je()}}).then((function(e){o.setState({comments:n})}));case 10:e.next=13;break;case 12:console.log("Could not find comment to delete");case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.title,n=e.date,a=e.body,s=e.commentValue,o=e.comments,r=e.upVoteDisabled,i=e.downVoteDisabled,c=e.icons,l=(e.isExpanded,e.isLoading);if(console.log("render state",this.state),l)return Object(Z.jsx)("div",{});var u=Object(ge.a)(Object(be.convertFromRaw)(JSON.parse(a))),d=this.currentRole,m=new Date(1e3*n),h=m.toLocaleDateString("en-US",{month:"long"})+", "+xe()(m).format("Do, YYYY, h:mm a");return Object(Z.jsx)("div",{children:Object(Z.jsxs)(pe.i,{children:[Object(Z.jsxs)(pe.c,{children:[Object(Z.jsx)(pe.e,{children:Object(Z.jsxs)(pe.g,{children:[Object(Z.jsx)("h2",{children:Object(Z.jsx)("em",{children:t})}),h]})}),Object(Z.jsx)(pe.d,{children:Object(Z.jsx)(pe.f,{children:Oe()(u)})})]}),Object(Z.jsx)(Re,{commentValue:s,handleCommentValue:this.handleCommentValue,enterCommentLine:this.enterCommentLine,submitCommentLine:this.submitCommentLine,onClose:this.onCommentClose,isExpanded:this.isExpanded}),"undefined"!==typeof o&&o&&o.length>0?Object(Z.jsx)("div",{children:Object(Z.jsx)(Je,{role:d,comments:o,incrementUpVote:this.incrementUpVote,incrementDownVote:this.incrementDownVote,upVoteDisabled:r,downVoteDisabled:i,icons:c,removeComment:this.removeComment,count:o.length,currentUsername:this.state.username})}):Object(Z.jsx)("div",{}),Object(Z.jsx)(pe.a,{color:"primary",tag:z.a,to:"/posts",children:"Return to Posts"})]})})}}]),n}(a.Component),Be=Me,He=n(5),Ge=["comp"],_e=function(e){var t=e.comp,n=Object(He.a)(e,Ge);return Object(Z.jsx)(L.b,Object(X.a)(Object(X.a)({},n),{},{render:function(e){return!0===C.loggedIn?Object(Z.jsx)(t,Object(X.a)({},e)):Object(Z.jsx)(L.a,{to:"/"})}}))},Ye=["comp"],Ke=function(e){var t=e.comp,n=Object(He.a)(e,Ye);return Object(Z.jsx)(L.b,Object(X.a)(Object(X.a)({},n),{},{render:function(e){if("/"!==n.path||!C.loggedIn)return Object(Z.jsx)(t,Object(X.a)({},e));C.logout()}}))},qe=function(e){Object(D.a)(n,e);var t=Object(N.a)(n);function n(){return Object(P.a)(this,n),t.apply(this,arguments)}return Object(V.a)(n,[{key:"render",value:function(){return Object(Z.jsx)("div",{children:Object(Z.jsx)(L.c,{history:j,children:Object(Z.jsxs)("div",{children:[Object(Z.jsx)(ue,{}),Object(Z.jsxs)(L.d,{children:[Object(Z.jsx)(Ke,{path:"/",exact:!0,comp:he}),Object(Z.jsx)(_e,{exact:!0,path:"/posts",comp:we}),Object(Z.jsx)(_e,{exact:!0,path:"/posts/edit/",comp:Ee}),Object(Z.jsx)(_e,{exact:!0,path:"/posts/view/",comp:Be}),Object(Z.jsx)(_e,{exact:!0,path:"/registration",comp:Le}),Object(Z.jsx)(_e,{exact:!0,path:"/profile",comp:De})]})]})})})}}]),n}(s.a.PureComponent);var Ze=function(e){var t=JSON.parse(localStorage.getItem("tokens")),n=Object(a.useState)(t||null),s=Object(i.a)(n,2);return s[0],s[1],Object(Z.jsx)(qe,{})},Qe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,629)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),a(e),s(e),o(e),r(e)}))};n(608);r.a.render(Object(Z.jsx)(s.a.StrictMode,{children:Object(Z.jsx)(Ze,{})}),document.getElementById("root")),Qe()},97:function(e,t,n){}},[[609,1,2]]]);
//# sourceMappingURL=main.4fe2c4ca.chunk.js.map